<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      width: 100%;
      height: 100%;
      overflow: auto;
      background: transparent;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    #pdf-container {
      background: transparent;
    }
    canvas {
      display: block;
      background: white;
    }
  </style>
</head>
<body>
<div id="pdf-container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
// 设置 PDF.js worker
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const pdfPath = '/uploads/invoices/1766036981698-hzi6jx3wt9-invoice-box.pdf';
const container = document.getElementById('pdf-container');

// 加载 PDF
pdfjsLib.getDocument({
  url: pdfPath,
  cMapUrl: 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/cmaps/',
  cMapPacked: true,
  standardFontDataUrl: 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/standard_fonts/'
}).promise.then(function(pdf) {
  console.log('PDF loaded, pages:', pdf.numPages);

  // 渲染所有页面
  const renderPromises = [];
  for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
    renderPromises.push(renderPage(pdf, pageNum));
  }

  return Promise.all(renderPromises);
}).catch(function(error) {
  console.error('Error loading PDF:', error);
  container.innerHTML = '<p style="padding: 20px;">无法加载 PDF 文件。请确保文件路径正确。</p>';
});

async function renderPage(pdf, pageNum) {
  const page = await pdf.getPage(pageNum);

  // 获取页面的原始尺寸
  const viewport = page.getViewport({ scale: 1.5 }); // 可以调整 scale 来控制清晰度

  // 创建 canvas
  const canvas = document.createElement('canvas');
  const context = canvas.getContext('2d');
  canvas.height = viewport.height;
  canvas.width = viewport.width;

  container.appendChild(canvas);

  // 渲染页面
  const renderContext = {
    canvasContext: context,
    viewport: viewport
  };

  await page.render(renderContext).promise;
  console.log('Page', pageNum, 'rendered');
}
</script>

</body>
</html>
